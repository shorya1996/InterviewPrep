%macro fraud_dashboard_by_rev(rev_filter=, outname=);

  /* STEP 1: FILTER BASED ON REV_TYPE */
  data filtered;
    set your_sql_summary;
    where upcase(rev_type) in (&rev_filter);
  run;

  /* STEP 2: TRANSFORM INTO LONG FORMAT */
  data long_format;
    set filtered;
    length score_name $20 score_bucket $20 groupkey $100;

    groupkey = catx('|', dollar_bucket, segment, pos_type);

    /* Score 1 - Network */
    score_name = "Network_Score";
    score_bucket = strip(put(Network_Score, $20.));
    bucket_order = input(score_bucket, best12.);
    fraud_rate_unit = unit_fraud_rate * 100;
    fraud_rate_dollar = dollar_fraud_rate * 100;
    fraud_txn_cnt = fraud_txn;
    fraud_amt = fraud_dollar;
    total_amt = total_dollar;
    output;

    /* Score 2 - ML */
    score_name = "ML_Score";
    score_bucket = strip(put(ML_score_bucket, $20.));
    bucket_order = input(score_bucket, best12.);
    fraud_rate_unit = unit_fraud_rate * 100;
    fraud_rate_dollar = dollar_fraud_rate * 100;
    fraud_txn_cnt = fraud_txn;
    fraud_amt = fraud_dollar;
    total_amt = total_dollar;
    output;

    /* Score 3 - SAS50 */
    score_name = "SAS50";
    score_bucket = strip(put(SAS50, $20.));
    bucket_order = input(score_bucket, best12.);
    fraud_rate_unit = unit_fraud_rate * 100;
    fraud_rate_dollar = dollar_fraud_rate * 100;
    fraud_txn_cnt = fraud_txn;
    fraud_amt = fraud_dollar;
    total_amt = total_dollar;
    output;
  run;

  /* STEP 3: CALCULATE VOLUME PERCENTAGES */
  proc sql;
    create table final_plot as
    select *,
           100.0 * total_txn / sum(total_txn) over (partition by groupkey, score_name) as vol_pct,
           100.0 * total_amt / sum(total_amt) over (partition by groupkey, score_name) as dollar_vol_pct
    from long_format;
  quit;

  /* STEP 4: BEGIN PDF EXPORT */
  ods pdf file="&outname..pdf" notoc dpi=300 style=journal;
  ods graphics / reset width=12in height=8in imagemap;

  /* CHART 1: Unit Fraud Rate */
  title "Fraud Rate (Unit %) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    series x=bucket_order y=fraud_rate_unit / group=score_name markers 
           lineattrs=(thickness=2) datalabel tip=(score_name score_bucket fraud_rate_unit);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Fraud Rate (Unit %)";
  run;

  /* CHART 2: Transaction Volume Share (%) */
  title "Transaction Volume (%) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    vbar bucket_order / response=vol_pct group=score_name groupdisplay=cluster
         dataskin=gloss datalabel tip=(score_name score_bucket vol_pct total_txn);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Transaction Volume (%)";
  run;

  /* CHART 3: Dollar Fraud Rate */
  title "Fraud Rate (Dollar %) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    series x=bucket_order y=fraud_rate_dollar / group=score_name markers 
           lineattrs=(thickness=2) datalabel tip=(score_name score_bucket fraud_rate_dollar);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Fraud Rate (Dollar %)";
  run;

  /* CHART 4: Dollar Volume Share (%) */
  title "Dollar Volume (%) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    vbar bucket_order / response=dollar_vol_pct group=score_name groupdisplay=cluster
         dataskin=pressed datalabel tip=(score_name score_bucket dollar_vol_pct total_amt);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Dollar Volume (%)";
  run;

  /* CHART 5: Fraud Count (Transactions) */
  title "Fraud Count (Txn) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    vbar bucket_order / response=fraud_txn_cnt group=score_name groupdisplay=cluster
         dataskin=gloss datalabel tip=(score_name score_bucket fraud_txn_cnt);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Fraud Count (Transactions)";
  run;

  /* CHART 6: Fraud Count (Dollar Amount) */
  title "Fraud Count (Dollar $) by Score Bucket - &outname";
  proc sgpanel data=final_plot;
    panelby groupkey / columns=3 spacing=4 novarname;
    series x=bucket_order y=fraud_amt / group=score_name markers 
           lineattrs=(thickness=2) datalabel tip=(score_name score_bucket fraud_amt);
    xaxis type=discrete valueshint display=(nolabel);
    yaxis label="Fraud Count (Dollar)";
  run;

  ods pdf close;
  title;

%mend;
